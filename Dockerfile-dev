FROM python:3.8.1-alpine3.11

ENV OPENSLIDES_BACKEND_COMPONENT=all
ENV OPENSLIDES_BACKEND_DEBUG 1

WORKDIR /srv/code

RUN apk add --no-cache gcc musl-dev linux-headers git

COPY requirements.txt .
COPY requirements_production.txt .
COPY cleanup.sh .
COPY setup.cfg .

RUN pip install --no-cache-dir --requirement requirements.txt

ARG OPENSLIDES_BACKEND_ACTION_PORT=9002
ARG OPENSLIDES_BACKEND_PRESENTER_PORT=9003

EXPOSE ${OPENSLIDES_BACKEND_ACTION_PORT}
EXPOSE ${OPENSLIDES_BACKEND_PRESENTER_PORT}

CMD [ "python", "-m", "openslides_backend" ]
